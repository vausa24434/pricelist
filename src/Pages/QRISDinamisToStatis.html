<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Hello, world!</title>
</head>

<body>
    <div class="container">
        <form>
            <div class="mb-3">
                <label for="qris" class="form-label">Qris</label>
                <input type="file" id="file" class="form-control">

                <div id="emailHelp" class="form-text">Silahkan upload Qris kamu</div>
            </div>
            <div class="mb-3">
                <label for="qris" class="form-label">Qris Data</label>
                <input type="text" id="qris" value placeholder="data text Qris" class="form-control">
            </div>
            <div class="mb-3">
                <label for="qty" class="form-label">Nominal</label>
                <input type="number" class="form-control" placeholder="Nominal Trakaksi" id="qty">
            </div>
            <div class="mb-3">
                <label for="fee" class="form-label">Fee Transaksi</label>
                <select id="fee" class="form-control" onchange="feeTrx(this.value)">
                    <option value="y">YA</option>
                    <option value="n" selected>Tidak</option>
                </select>
            </div>
            <div id="fetrx">
            </div>
            <button type="button" onclick="createQris()" class="btn btn-success">Submit</button>
            <button type="button" onclick="refresh()" class="btn btn-primary">Refresh</button>
        </form>
        <input type="hidden" id="token" value="QWNA7R8sxgNmA" />
        <div class="mb-3">
            <div id="img"></div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
</body>
<script>
    function refresh() {
        window.location.reload();
    }

    function feeTrx(val) {
        let html = '<div class="mb-3"><label for="tipe" class="form-label">Tpe Fee Transaksi</label><select id="tipe" class="form-control"><option value="p">Persen</option><option value="r">Rupiah</option></select></div><div class="mb-3"><label for="tipe" class="form-label">Biaya Admin</label><input type="number" id="admin" class="form-control"></div>'
        if (val == 'y') {
            $('#fetrx').html(html);
        } else {
            $('#fetrx').html('');
        }
    }

    function createQris() {
        if ($('#qty').val() == '' || $('#qris').val() == '') {
            alert('Qris data dan Nominal tidak boleh kosong')
        } else if ($('#qty').val() >= 10000) {
            $.ajax({
                url: 'qris.php',
                data: {
                    csrf: $('#token').val(),
                    qris: $('#qris').val(),
                    qty: $('#qty').val(),
                    fee: $('#fee').val(),
                    tipe: $('#tipe').val(),
                    admin: $('#admin').val()
                },
                type: 'POST',
                dataType: 'html',
                beforeSend: function (data) {
                    $('#img').html('<h1>Mohon tunggu...</h1>')
                },
                success: function (data) {
                    $('#img').html(data)
                },
                error: function () {
                    $('#img').html('<h1>Permintaan tidak valid, Silahkan refresh halaman</h1>');
                }
            });
            $(document).scrollTop($(document).height());
        } else {
            alert('Mininal Nominal adalah 10k');
        }
    }
    $('#file').change(function () {
        let formData = new FormData();
        formData.append('file', file.files[0]);
        console.log(formData);
        $.ajax({
            url: 'file.php?csrf=' + $('#token').val(),  //Server script to process data
            type: 'POST',
            data: formData,
            contentType: false,
            processData: false,
            beforeSend: function () {
                $('#img').html('<h1>Mohon ditunggu</h1>');
            },
            success: function (html) {
                $('#qris').val(html);
                $('#img').html('');
            },
            error: function (html) {
                alert(html);
                $('#img').html('');
            }

        });
    });

</script>

</html>